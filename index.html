<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pers√∂nlichkeitsautomat 3000</title>
  <title>Personal Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 2rem; background: #fefefe; color: #333; }
    h1 { text-align: center; }
    textarea, input, select, button {
      width: 100%; padding: 8px; margin: 8px 0; border-radius: 5px; border: 1px solid #ccc;
    }
    button { background: #4caf50; color: white; border: none; cursor: pointer; }
    button:hover { background: #45a049; }
    .frage-container { margin-top: 1rem; }
    #profil { white-space: pre-wrap; background: #f4f4f4; padding: 1rem; border-radius: 5px; margin-top: 1rem; }
    :root {
      color-scheme: light dark;
      --bg: #0f172a;
      --card: rgba(15, 23, 42, 0.75);
      --card-border: rgba(255, 255, 255, 0.08);
      --text: #e2e8f0;
      --text-muted: #94a3b8;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top left, #1e293b, #020617 55%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      padding: 2rem min(4vw, 3rem) 3rem;
      gap: 2rem;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-end;
      gap: 1rem;
    }

    header h1 {
      font-size: clamp(2.2rem, 4vw, 3rem);
      margin: 0;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    header p {
      margin: 0;
      color: var(--text-muted);
      font-size: 1rem;
      max-width: 520px;
      line-height: 1.5;
    }

    main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    section {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      padding: 1.5rem;
      backdrop-filter: blur(18px);
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.45);
    }

    section h2 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    label {
      display: block;
      font-size: 0.85rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    input, select, button, textarea {
      width: 100%;
      padding: 0.75rem 0.85rem;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.4);
      color: var(--text);
      font-family: inherit;
      font-size: 0.95rem;
      transition: border-color 0.2s ease, transform 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    textarea { resize: vertical; min-height: 120px; }

    button {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.9), rgba(14, 165, 233, 0.9));
      border: none;
      font-weight: 600;
      cursor: pointer;
    }

    button:hover {
      transform: translateY(-1px);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .list-item {
      padding: 0.75rem 0.85rem;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.12);
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .list-item strong { font-size: 1rem; }

    .muted { color: var(--text-muted); font-size: 0.85rem; }

    .calendar-controls, .weather-controls, .stocks-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem;
    }

    .stocks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.75rem;
    }

    .empty-state {
      border: 1px dashed rgba(148, 163, 184, 0.4);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .notes {
      min-height: 220px;
    }

    footer {
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    @media (max-width: 720px) {
      body { padding: 1.5rem 1.25rem 2.5rem; }
      main { gap: 1rem; }
      section { padding: 1.25rem; }
    }
  </style>
</head>
<body>
  <h1>üéõÔ∏è Pers√∂nlichkeitsautomat 3000</h1>
  <label>API-Key</label>
  <input id="apiKey" type="text" placeholder="sk-..." />
  <div id="statusBox"></div>
  <header>
    <div>
      <h1>Control Center</h1>
      <p>Dein pers√∂nliches Web-Dashboard mit Kalender, Wetter, Aktienkursen und schnellen Notizen. Hinterlege deine API-Keys, passe die Widgets an und starte mit einem Blick in den Tag.</p>
    </div>
    <div class="pill">Live Widgets</div>
  </header>

  <main>
    <section id="calendar-section">
      <h2>üìÖ Google Kalender</h2>
      <div class="calendar-controls">
        <div>
          <label for="calendarApiKey">Google API-Key</label>
          <input type="text" id="calendarApiKey" placeholder="AIza..." />
        </div>
        <div>
          <label for="calendarId">Kalender-ID</label>
          <input type="text" id="calendarId" placeholder="example@gmail.com" />
        </div>
        <div>
          <label for="calendarMaxResults">Max. Termine</label>
          <select id="calendarMaxResults">
            <option value="5" selected>5</option>
            <option value="10">10</option>
            <option value="15">15</option>
          </select>
        </div>
      </div>
      <button type="button" onclick="loadCalendarEvents()">Kalender aktualisieren</button>
      <div id="calendarEvents" class="list"></div>
    </section>

  <label>Name des Gastes</label>
  <input type="text" id="gastName" placeholder="Vorname oder Spitzname" />
    <section id="weather-section">
      <h2>üå§Ô∏è Wetter & Tagesverlauf</h2>
      <div class="weather-controls">
        <div>
          <label for="weatherCity">Ort</label>
          <input type="text" id="weatherCity" placeholder="z.B. Berlin" />
        </div>
        <div>
          <label for="weatherCountry">Land-Code</label>
          <input type="text" id="weatherCountry" placeholder="DE" maxlength="2" />
        </div>
      </div>
      <button type="button" onclick="loadWeather()">Wetter abrufen</button>
      <div id="weatherContent">
        <div class="empty-state">Keine Daten geladen. Ort w√§hlen und auf ‚ÄûWetter abrufen‚Äú klicken.</div>
      </div>
    </section>

  <label>Geburtsdatum</label>
  <input type="date" id="geburtstag" />
    <section id="stocks-section">
      <h2>üìà B√∂rsenkurse</h2>
      <p class="muted">Nutze eine Alpha-Vantage-API und trenne mehrere K√ºrzel mit Komma (z.B. AAPL,MSFT,GOOGL).</p>
      <div class="stocks-controls">
        <div>
          <label for="stocksApiKey">Alpha Vantage API-Key</label>
          <input type="text" id="stocksApiKey" placeholder="demo" />
        </div>
        <div>
          <label for="stocksSymbols">Ticker</label>
          <input type="text" id="stocksSymbols" placeholder="AAPL,MSFT" />
        </div>
      </div>
      <button type="button" onclick="loadStocks()">Kurse laden</button>
      <div id="stocksContent" class="stocks-grid"></div>
    </section>

  <label>Fragen bearbeiten (eine pro Zeile)</label>
  <textarea id="fragenText"></textarea>
    <section id="tasks-section">
      <h2>‚úÖ Schnelle To-dos</h2>
      <div>
        <label for="todoInput">Neue Aufgabe</label>
        <input type="text" id="todoInput" placeholder="E-Mail beantworten..." onkeydown="if(event.key==='Enter'){addTodo();}" />
        <button type="button" onclick="addTodo()">Aufgabe hinzuf√ºgen</button>
      </div>
      <ul id="todoList" class="list" style="list-style: none; padding: 0; margin: 0;"></ul>
    </section>

  <select id="presetSelect" onchange="ladePreset()"><option value="">‚Äì Auswahl ‚Äì</option></select>
  <button onclick="speicherePreset()">Preset speichern</button>
  <button onclick="generiereFragefelder()">Fragen √ºbernehmen</button>
  <button onclick="shuffleFragen()">Fragen mischen</button>
  <button onclick="generiereNeueFragen()">Neue Fragen generieren (KI)</button>
  <div id="fragenContainer"></div>
  <button onclick="generiereProfil()">Auswertung starten</button>
  <div id="profil"></div>
    <section id="notes-section">
      <h2>üóíÔ∏è Notizen</h2>
      <textarea id="notes" class="notes" placeholder="Schnelle Gedanken, Ideen oder Links..." oninput="saveNotes()"></textarea>
      <p class="muted">Notizen werden lokal im Browser gespeichert.</p>
    </section>
  </main>

  <footer>
    üìå Hinweis: API-Keys werden ausschlie√ülich im Browser gespeichert. Keine sensiblen Daten hier hochladen.
  </footer>

  <script>
    const presets = JSON.parse(localStorage.getItem("presets") || '{}');
    if (!presets["Gianluca"]) {
      presets["Gianluca"] = [
        "Wenn du einen Tag in einem Film leben m√ºsstest ‚Äì welcher w√§re das und warum?",
        "Wenn dich jemand fragt, woher du kommst ‚Äì was antwortest du?",
        "Was schiebst du immer wieder vor dir her, weil‚Äôs einfach m√ºhsam ist?",
        "Was war dein letzter innerer Applaus-Moment?",
        "Supermarkt-Challenge: Welche drei Artikel w√ºrdest du kaufen, um die Kassiererin maximal zu verwirren?",
        "Du darfst ein Abendessen mit drei Figuren haben ‚Äì real oder fiktiv. Wen l√§dst du ein und warum?",
        "Angenommen, du wirst verhaftet ‚Äì wof√ºr w√ºrde dich dein Umfeld am ehesten verd√§chtigen?",
        "Wenn Geld absolut keine Rolle spielen w√ºrde ‚Äì was w√ºrdest du beruflich machen, einfach nur aus Freude?",
        "Was brauchst du, um dich rundum wohl und frisch zu f√ºhlen ‚Äì innen wie au√üen?",
        "Wenn du einen neuen Feiertag erfinden k√∂nntest ‚Äì was w√§re das Thema und wie w√ºrde man feiern?"
      ];
    }

    function aktualisierePresetDropdown() {
      const select = document.getElementById("presetSelect");
      select.innerHTML = '<option value="">‚Äì Auswahl ‚Äì</option>';
      Object.keys(presets).forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });
    }

    function ladePreset() {
      const name = document.getElementById("presetSelect").value;
      if (name && presets[name]) {
        document.getElementById("fragenText").value = presets[name].join("\n");
        generiereFragefelder();
      }
    const STORAGE_KEYS = {
      CALENDAR_API: "dashboard.calendarApiKey",
      CALENDAR_ID: "dashboard.calendarId",
      CALENDAR_MAX: "dashboard.calendarMax",
      WEATHER_CITY: "dashboard.weatherCity",
      WEATHER_COUNTRY: "dashboard.weatherCountry",
      STOCKS_API: "dashboard.stocksApi",
      STOCKS_SYMBOLS: "dashboard.stocksSymbols",
      TODOS: "dashboard.todos",
      NOTES: "dashboard.notes"
    };

    document.addEventListener("DOMContentLoaded", () => {
      restoreInputs();
      renderTodos();
      loadSavedNotes();
    });

    function restoreInputs() {
      const calendarApiKey = localStorage.getItem(STORAGE_KEYS.CALENDAR_API) || "";
      const calendarId = localStorage.getItem(STORAGE_KEYS.CALENDAR_ID) || "";
      const calendarMax = localStorage.getItem(STORAGE_KEYS.CALENDAR_MAX) || "5";
      const weatherCity = localStorage.getItem(STORAGE_KEYS.WEATHER_CITY) || "";
      const weatherCountry = localStorage.getItem(STORAGE_KEYS.WEATHER_COUNTRY) || "";
      const stocksApi = localStorage.getItem(STORAGE_KEYS.STOCKS_API) || "";
      const stocksSymbols = localStorage.getItem(STORAGE_KEYS.STOCKS_SYMBOLS) || "";

      document.getElementById("calendarApiKey").value = calendarApiKey;
      document.getElementById("calendarId").value = calendarId;
      document.getElementById("calendarMaxResults").value = calendarMax;
      document.getElementById("weatherCity").value = weatherCity;
      document.getElementById("weatherCountry").value = weatherCountry;
      document.getElementById("stocksApiKey").value = stocksApi;
      document.getElementById("stocksSymbols").value = stocksSymbols;
    }

    function persistInput(id, key) {
      const value = document.getElementById(id).value.trim();
      localStorage.setItem(key, value);
      return value;
    }

    function speicherePreset() {
      const name = prompt("Name f√ºr Preset?");
      if (!name) return;
      const fragen = document.getElementById("fragenText").value.trim().split("\n");
      presets[name] = fragen;
      localStorage.setItem("presets", JSON.stringify(presets));
      aktualisierePresetDropdown();
      alert("Gespeichert als: " + name);
    }

    function generiereFragefelder() {
      const fragen = document.getElementById("fragenText").value.trim().split("\n");
      const container = document.getElementById("fragenContainer");
      container.innerHTML = "";
      fragen.forEach((frage, i) => {
        const div = document.createElement("div");
        div.className = "frage-container";
        div.innerHTML = `<label>${frage}</label><textarea id="antwort${i}"></textarea>`;
        container.appendChild(div);
      });
    }

    async function generiereProfil() {
      const fragen = document.getElementById("fragenText").value.trim().split("\n");
      const antworten = fragen.map((_, i) => document.getElementById("antwort" + i)?.value || "");
      const geburtstag = document.getElementById("geburtstag").value;
      const gastName = document.getElementById("gastName").value;
      const apiKey = document.getElementById("apiKey").value.trim();
      if (!apiKey || !geburtstag || antworten.some(a => !a.trim()) || !gastName.trim()) {
        alert("Bitte alles ausf√ºllen!");
    [
      ["calendarApiKey", STORAGE_KEYS.CALENDAR_API],
      ["calendarId", STORAGE_KEYS.CALENDAR_ID],
      ["calendarMaxResults", STORAGE_KEYS.CALENDAR_MAX],
      ["weatherCity", STORAGE_KEYS.WEATHER_CITY],
      ["weatherCountry", STORAGE_KEYS.WEATHER_COUNTRY],
      ["stocksApiKey", STORAGE_KEYS.STOCKS_API],
      ["stocksSymbols", STORAGE_KEYS.STOCKS_SYMBOLS]
    ].forEach(([id, key]) => {
      document.getElementById(id).addEventListener("change", () => persistInput(id, key));
    });

    async function loadCalendarEvents() {
      const apiKey = persistInput("calendarApiKey", STORAGE_KEYS.CALENDAR_API);
      const calendarId = persistInput("calendarId", STORAGE_KEYS.CALENDAR_ID);
      const maxResults = persistInput("calendarMaxResults", STORAGE_KEYS.CALENDAR_MAX) || "5";
      const container = document.getElementById("calendarEvents");

      if (!apiKey || !calendarId) {
        container.innerHTML = `<div class="empty-state">Bitte API-Key und Kalender-ID eintragen.</div>`;
        return;
      }
      const geburtsTag = new Date(geburtstag).toLocaleDateString("de-DE", { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
      const prompt = `Name: ${gastName}\nGeburtstag: ${geburtstag} (${geburtsTag})\n` + fragen.map((f, i) => `${f} ‚Äì ${antworten[i]}`).join("\n") + "\nBitte analysiere die Pers√∂nlichkeit auf lustige, kreative Weise (ca. 2500 Zeichen).";
      document.getElementById("profil").innerText = "‚è≥ Bitte warten ...";

      const url = new URL(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events`);
      url.searchParams.set("key", apiKey);
      url.searchParams.set("timeMin", new Date().toISOString());
      url.searchParams.set("singleEvents", "true");
      url.searchParams.set("orderBy", "startTime");
      url.searchParams.set("maxResults", maxResults);

      container.innerHTML = `<div class="empty-state">Lade Termine...</div>`;

      try {
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [
              { role: "system", content: "Du bist ein witziger, kreativer Pers√∂nlichkeitsanalytiker." },
              { role: "user", content: prompt }
            ],
            max_tokens: 1500,
            temperature: 0.9
          })
        });
        const res = await fetch(url.toString());
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        document.getElementById("profil").innerText = data.choices?.[0]?.message?.content || "Keine Antwort.";
      } catch (e) {
        document.getElementById("profil").innerText = "‚ö†Ô∏è Fehler bei der KI-Anfrage.";
        const events = data.items || [];

        if (!events.length) {
          container.innerHTML = `<div class="empty-state">Keine anstehenden Termine gefunden.</div>`;
          return;
        }

        container.innerHTML = events.map(event => {
          const start = event.start?.dateTime || event.start?.date;
          const startDate = start ? new Date(start) : null;
          const formatted = startDate ? startDate.toLocaleString("de-DE", { dateStyle: "medium", timeStyle: event.start?.date ? undefined : "short" }) : "";
          return `
            <div class="list-item">
              <strong>${event.summary || "(Kein Titel)"}</strong>
              <span class="muted">${formatted}</span>
              ${event.location ? `<span class="muted">üìç ${event.location}</span>` : ""}
            </div>
          `;
        }).join("");
      } catch (error) {
        container.innerHTML = `<div class="empty-state">Fehler beim Laden: ${error.message}</div>`;
      }
    }

    async function generiereNeueFragen() {
      const apiKey = document.getElementById("apiKey").value.trim();
      if (!apiKey) return alert("API-Key fehlt.");
    async function loadWeather() {
      const city = persistInput("weatherCity", STORAGE_KEYS.WEATHER_CITY);
      const country = persistInput("weatherCountry", STORAGE_KEYS.WEATHER_COUNTRY);
      const container = document.getElementById("weatherContent");

      if (!city) {
        container.innerHTML = `<div class="empty-state">Bitte einen Ort eingeben.</div>`;
        return;
      }

      container.innerHTML = `<div class="empty-state">Suche Standort...</div>`;

      try {
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [{ role: "user", content: "Erstelle 10 lustige, originelle Podcast-Interviewfragen (eine pro Zeile)." }],
            max_tokens: 500,
            temperature: 0.95
          })
        });
        const data = await res.json();
        const fragen = data.choices?.[0]?.message?.content.trim();
        if (fragen) {
          document.getElementById("fragenText").value = fragen;
          generiereFragefelder();
        const geoUrl = new URL("https://geocoding-api.open-meteo.com/v1/search");
        geoUrl.searchParams.set("name", city);
        if (country) geoUrl.searchParams.set("country", country);
        geoUrl.searchParams.set("count", "1");
        const geoRes = await fetch(geoUrl.toString());
        if (!geoRes.ok) throw new Error(`Geocoding HTTP ${geoRes.status}`);
        const geo = await geoRes.json();
        const location = geo.results?.[0];
        if (!location) {
          container.innerHTML = `<div class="empty-state">Ort wurde nicht gefunden.</div>`;
          return;
        }
      } catch (e) {
        alert("Fehler beim Generieren.");

        container.innerHTML = `<div class="empty-state">Lade Wetterdaten f√ºr ${location.name}...</div>`;

        const weatherUrl = new URL("https://api.open-meteo.com/v1/forecast");
        weatherUrl.searchParams.set("latitude", location.latitude);
        weatherUrl.searchParams.set("longitude", location.longitude);
        weatherUrl.searchParams.set("current_weather", "true");
        weatherUrl.searchParams.set("daily", "temperature_2m_max,temperature_2m_min,weathercode");
        weatherUrl.searchParams.set("hourly", "temperature_2m,precipitation");
        weatherUrl.searchParams.set("timezone", "auto");

        const weatherRes = await fetch(weatherUrl.toString());
        if (!weatherRes.ok) throw new Error(`Weather HTTP ${weatherRes.status}`);
        const weather = await weatherRes.json();

        const current = weather.current_weather;
        const daily = weather.daily;

        const weatherCodeMap = {
          0: "Klarer Himmel",
          1: "√úberwiegend klar",
          2: "Teils bew√∂lkt",
          3: "Bew√∂lkt",
          45: "Nebel",
          48: "Reifnebel",
          51: "Leichter Niesel",
          53: "M√§√üiger Niesel",
          55: "Starker Niesel",
          61: "Leichter Regen",
          63: "Regen",
          65: "Starker Regen",
          71: "Leichter Schneefall",
          73: "Schneefall",
          75: "Starker Schneefall",
          95: "Gewitter",
          96: "Gewitter + Hagel",
          99: "Heftiges Gewitter"
        };

        const forecast = daily.time?.slice(0, 3).map((day, index) => {
          const date = new Date(day).toLocaleDateString("de-DE", { weekday: "long", day: "2-digit", month: "2-digit" });
          const max = Math.round(daily.temperature_2m_max[index]);
          const min = Math.round(daily.temperature_2m_min[index]);
          const code = weatherCodeMap[daily.weathercode[index]] || "";
          return `
            <div class="list-item">
              <strong>${date}</strong>
              <span class="muted">${code}</span>
              <span>${min}¬∞C ‚Äì ${max}¬∞C</span>
            </div>
          `;
        }).join("");

        container.innerHTML = `
          <div class="list">
            <div class="list-item">
              <strong>Jetzt in ${location.name}</strong>
              <span class="muted">${weatherCodeMap[current.weathercode] || ""}</span>
              <span style="font-size: 2rem; font-weight: 700;">${Math.round(current.temperature)}¬∞C</span>
              <span class="muted">Wind: ${Math.round(current.windspeed)} km/h</span>
            </div>
            <div class="muted">Vorhersage (n√§chste 3 Tage)</div>
            ${forecast}
          </div>
        `;
      } catch (error) {
        container.innerHTML = `<div class="empty-state">Fehler: ${error.message}</div>`;
      }
    }

    function shuffleFragen() {
      const fragen = document.getElementById("fragenText").value.trim().split("\n");
      for (let i = fragen.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [fragen[i], fragen[j]] = [fragen[j], fragen[i]];
    async function loadStocks() {
      const apiKey = persistInput("stocksApiKey", STORAGE_KEYS.STOCKS_API);
      const symbolsInput = persistInput("stocksSymbols", STORAGE_KEYS.STOCKS_SYMBOLS);
      const container = document.getElementById("stocksContent");

      if (!apiKey || !symbolsInput) {
        container.innerHTML = `<div class="empty-state" style="grid-column: 1 / -1;">API-Key und mindestens ein Ticker erforderlich.</div>`;
        return;
      }

      const symbols = symbolsInput.split(",").map(s => s.trim().toUpperCase()).filter(Boolean);
      if (!symbols.length) {
        container.innerHTML = `<div class="empty-state" style="grid-column: 1 / -1;">Bitte g√ºltige Ticker eintragen.</div>`;
        return;
      }

      container.innerHTML = `<div class="empty-state" style="grid-column: 1 / -1;">Lade Kurse...</div>`;

      try {
        const results = await Promise.all(symbols.map(async symbol => {
          const url = new URL("https://www.alphavantage.co/query");
          url.searchParams.set("function", "GLOBAL_QUOTE");
          url.searchParams.set("symbol", symbol);
          url.searchParams.set("apikey", apiKey);
          const res = await fetch(url.toString());
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          return data["Global Quote"]; 
        }));

        container.innerHTML = results.map((quote, index) => {
          if (!quote || Object.keys(quote).length === 0) {
            return `<div class="list-item" style="grid-column: span 1;">
              <strong>${symbols[index]}</strong>
              <span class="muted">Keine Daten gefunden (Rate-Limit?)</span>
            </div>`;
          }

          const price = Number(quote["05. price"]).toFixed(2);
          const change = Number(quote["09. change"]).toFixed(2);
          const changePercent = quote["10. change percent"];
          const positive = parseFloat(change) >= 0;

          return `
            <div class="list-item" style="grid-column: span 1;">
              <strong>${quote["01. symbol"] || symbols[index]}</strong>
              <span style="font-size: 1.35rem; font-weight: 700;">$${price}</span>
              <span style="color: ${positive ? '#34d399' : '#f87171'}; font-weight: 600;">
                ${positive ? '‚ñ≤' : '‚ñº'} ${Math.abs(change)} (${changePercent})
              </span>
              <span class="muted">Letztes Update: ${quote["07. latest trading day"] || "n/a"}</span>
            </div>
          `;
        }).join("");
      } catch (error) {
        container.innerHTML = `<div class="empty-state" style="grid-column: 1 / -1;">Fehler: ${error.message}</div>`;
      }
      document.getElementById("fragenText").value = fragen.join("\n");
      generiereFragefelder();
    }

    function checkAPIStatus() {
      const key = document.getElementById("apiKey").value.trim();
      const box = document.getElementById("statusBox");
      if (!key) {
        box.innerText = "‚ùå Kein API Key eingetragen";
    function addTodo() {
      const input = document.getElementById("todoInput");
      const text = input.value.trim();
      if (!text) return;
      const todos = getTodos();
      todos.push({ text, done: false, id: Date.now() });
      localStorage.setItem(STORAGE_KEYS.TODOS, JSON.stringify(todos));
      input.value = "";
      renderTodos();
    }

    function toggleTodo(id) {
      const todos = getTodos().map(todo => todo.id === id ? { ...todo, done: !todo.done } : todo);
      localStorage.setItem(STORAGE_KEYS.TODOS, JSON.stringify(todos));
      renderTodos();
    }

    function deleteTodo(id) {
      const todos = getTodos().filter(todo => todo.id !== id);
      localStorage.setItem(STORAGE_KEYS.TODOS, JSON.stringify(todos));
      renderTodos();
    }

    function getTodos() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEYS.TODOS)) || [];
      } catch (_) {
        return [];
      }
    }

    function renderTodos() {
      const list = document.getElementById("todoList");
      const todos = getTodos();
      if (!todos.length) {
        list.innerHTML = `<div class="empty-state">Keine Aufgaben ‚Äì alles erledigt! üéâ</div>`;
        return;
      }
      fetch("https://api.openai.com/v1/models", {
        headers: { "Authorization": `Bearer ${key}` }
      })
      .then(res => {
        if (res.ok) {
          box.innerText = "‚úÖ API-Verbindung aktiv";
        } else {
          box.innerText = "‚ö†Ô∏è API-Key ung√ºltig oder Verbindung gest√∂rt";
        }
      })
      .catch(() => {
        box.innerText = "‚ö†Ô∏è Verbindung fehlgeschlagen";
      });
      list.innerHTML = todos.map(todo => `
        <li class="list-item" style="display: flex; align-items: center; justify-content: space-between; gap: 0.75rem;">
          <div style="display: flex; align-items: center; gap: 0.75rem;">
            <input type="checkbox" ${todo.done ? "checked" : ""} onchange="toggleTodo(${todo.id})" style="width: auto;" />
            <span style="text-decoration: ${todo.done ? 'line-through' : 'none'}; color: ${todo.done ? 'var(--text-muted)' : 'inherit'};">${todo.text}</span>
          </div>
          <button type="button" onclick="deleteTodo(${todo.id})" style="width: auto; padding: 0.35rem 0.75rem; background: rgba(248, 113, 113, 0.25); border: 1px solid rgba(248, 113, 113, 0.4);">L√∂schen</button>
        </li>
      `).join("");
    }

    function saveNotes() {
      const notes = document.getElementById("notes").value;
      localStorage.setItem(STORAGE_KEYS.NOTES, notes);
    }

    aktualisierePresetDropdown();
    generiereFragefelder();
    checkAPIStatus();
    document.getElementById("apiKey").addEventListener("change", checkAPIStatus);
    function loadSavedNotes() {
      const notes = localStorage.getItem(STORAGE_KEYS.NOTES);
      if (notes) {
        document.getElementById("notes").value = notes;
      }
    }
  </script>
</body>
</html>
